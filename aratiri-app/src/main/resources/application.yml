server:
  port: ${SERVER_PORT:2100}

spring:
  application:
    name: aratiri
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://postgres_db:5432/aratiri_db}
    username: ${SPRING_DATASOURCE_USERNAME:aratiri_user}
    password: ${SPRING_DATASOURCE_PASSWORD:aratiri_password}
    driver-class-name: ${SPRING_DATASOURCE_DRIVER:org.postgresql.Driver}
    hikari:
      maximum-pool-size: ${HIKARI_MAXIMUM_POOL_SIZE:20}
      idle-timeout: ${HIKARI_IDLE_TIMEOUT:600000}
      max-lifetime: ${HIKARI_MAX_LIFETIME:1800000}
      connection-timeout: ${HIKARI_CONNECTION_TIMEOUT:30000}
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_OAUTH_CLIENT_ID:}
  jpa:
    properties:
      hibernate:
        default_schema: ${SPRING_JPA_DEFAULT_SCHEMA:aratiri}
    hibernate:
      ddl-auto: ${SPRING_JPA_DDL_AUTO:update}
    show-sql: false
    database-platform: ${SPRING_JPA_DATABASE_PLATFORM:org.hibernate.dialect.PostgreSQLDialect}

  mail:
    host: smtp.gmail.com
    port: 587
    username: ${EMAIL_USERNAME}
    password: ${EMAIL_PASSWORD}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS}
    consumer:
      group-id: invoice-listener-group
      auto-offset-reset: earliest
      enable-auto-commit: false
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.StringSerializer
    listener:
      ack-mode: manual_immediate
  flyway:
    schemas: ${SPRING_FLYWAY_SCHEMAS:aratiri}
    default-schema: ${SPRING_FLYWAY_DEFAULT_SCHEMA:aratiri}
grpc:
  client:
    lnd:
      name: ${GRPC_CLIENT_LND_NAME}
      port: ${GRPC_CLIENT_LND_PORT}
  tls:
    active: ${GRPC_TLS_ACTIVE:true}

lnd:
  path:
    tls:
      cert: ${LND_TLS_CERT_PATH:}
    macaroon:
      admin: ${ADMIN_MACAROON_PATH}

aratiri:
  base:
    url: ${ARATIRI_BASE_URL}
  cors:
    allowed:
      origins: ${ARATIRI_CORS_ALLOWED_ORIGINS}
  currency:
    conversion:
      api:
        url: ${ARATIRI_CURRENCY_CONVERSION_API_URL:https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=%s}\
      fallback:
        api:
          url: ${ARATIRI_CURRENCY_CONVERSION_FALLBACK_API_URL:https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/%s.json}
  accounts:
    fiat:
      currencies: ${ARATIRI_ACCOUNTS_FIAT_CURRENCIES:usd,pyg,ars,eur}
  security:
    default-principal-claim: ${ARATIRI_SECURITY_DEFAULT_PRINCIPAL_CLAIM:email}
    token-exchange:
      enabled: ${ARATIRI_TOKEN_EXCHANGE_ENABLED:false}
      client-id: ${ARATIRI_TOKEN_EXCHANGE_CLIENT_ID:}
      client-secret: ${ARATIRI_TOKEN_EXCHANGE_CLIENT_SECRET:}
    trusted-issuers:
      - issuer: ${ARATIRI_TRUSTED_ISSUER:http://localhost:8000}
        jwk-set-uri: ${ARATIRI_TRUSTED_ISSUER_JWK_SET_URI:http://localhost:8000/jwks.json}
        principal-claim: ${ARATIRI_TRUSTED_ISSUER_PRINCIPAL_CLAIM:email}
        name-claim: ${ARATIRI_TRUSTED_ISSUER_NAME_CLAIM:name}
        auto-provision-user: ${ARATIRI_TRUSTED_ISSUER_AUTO_PROVISION:true}
        auto-provision-account: ${ARATIRI_TRUSTED_ISSUER_AUTO_ACCOUNT:true}
        audience:
          - aratiri-local
        provider: ${ARATIRI_TRUSTED_ISSUER_PROVIDER:EXTERNAL}
        default-role: ${ARATIRI_TRUSTED_ISSUER_DEFAULT_ROLE:USER}
nostr:
  active: ${NOSTR_ACTIVE:true}
  relay:
    url: ${NOSTR_RELAY_URL:wss://relay.primal.net}
  retry:
    max-retries: ${NOSTR_RETRY_MAX:5}
    initial-delay: ${NOSTR_RETRY_INITIAL_DELAY:2000}
    max-delay: ${NOSTR_RETRY_MAX_DELAY:300000}
  payment:
    default:
      fee:
        limit:
          sat: ${ARATIRI_PAYMENT_DEFAULT_FEE_LIMIT_SAT:50}
      timeout:
        seconds: ${ARATIRI_PAYMENT_DEFAULT_TIMEOUT_SECONDS:200}
    lightning:
      fee:
        fixed:
          sat: ${ARATIRI_PAYMENT_LIGHTNING_FEE_FIXED_SAT:0}
        percent: ${ARATIRI_PAYMENT_LIGHTNING_FEE_PERCENT:0}
    onchain:
      fee:
        fixed:
          sat: ${ARATIRI_PAYMENT_ONCHAIN_FEE_FIXED_SAT:0}
        percent: ${ARATIRI_PAYMENT_ONCHAIN_FEE_PERCENT:0}
jwt:
  secret: ${JWT_SECRET}
  expiration: ${JWT_EXPIRATION:8400}
  refresh-expiration: ${JWT_REFRESH_EXPIRATION:2592000}